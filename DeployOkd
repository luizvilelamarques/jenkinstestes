def clusterName
def serviceName
def deploymentConfig

def instancia(deployInfo){
    clusterName = deployInfo.clusterName
    serviceName = deployInfo.service.name
    deploymentConfig = deployInfo.service.name + '-srv'
    return this
}

def deploy() {
    if (deployInfo.deploymentConfig.rolout){
        _rolout()
    }else{
        _apply()
    }
}

def _apply() {
    openshift.withCluster(clusterName) {
         openshift.withProject(serviceName) {
            def templateSelector = openshift.selector( "template", "openshift-test-template")
            if (!templateSelector.exists()) {
                openshift.create(readFile('template-openshift.json'))
            } else {
                openshift.apply(readFile('template-openshift.json'))
            }
         }
    }
}

def _rolout() {
    openshift.withCluster(clusterName) {
         openshift.withProject(serviceName) {
            openshift.selector("dc", deploymentConfig).rollout().latest()    
         }
    }
}

return this
